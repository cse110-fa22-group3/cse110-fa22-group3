<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: front-end/modules/bill-divider/js/main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: front-end/modules/bill-divider/js/main.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {readRoommate} from "../../../../back-end/roommateListAPI.js";
let roommates=readRoommate()
function getRoommate(id) {
    for (let i = 0; i &lt; roommates.length; i++) {
      if (roommates[i].id == id) return roommates[i];
    }
    return null;
  }
console.log(roommates)
//create a roommate item
window.addEventListener('DOMContentLoaded', init);
function init() {
    init_list()
    pay()
    transfer()
    del_history()
}
let cardBox = document.querySelectorAll('.card')
let array=[]//array containing data objects
let history_array=[]
/**
 * 
 * @param {Object} data 
 * create a roommate card using information in the input data object
 */
function create(data){
    let wrapper = document.createElement('li')
    wrapper.innerHTML=`&lt;h3>${getRoommate(data.id).name}&lt;/h3>`
    if(data.isOwed!=0)
        wrapper.insertAdjacentHTML('beforeend', `&lt;p>is Owed $${data.isOwed}&lt;/p>`)
    for(let [key,value] of Object.entries(data.Owes)){
      if(key!=getRoommate(data.id).name &amp;&amp; value!=0)
        wrapper.insertAdjacentHTML('beforeend', `&lt;span>Owes $${value} to ${key}!&lt;/span>&lt;br>`)
    }
    let list=document.querySelector('ul[class="list mb-3"]')
    list.append(wrapper)
}
/**
 * initialize a sample data object array
 * and create the roommate cards and their corresponding radio buttons
 */
function init_list(){
    // let initial_data=[
    //     {
    //         name:"gjcghjv",
    //         isOwed:0,
    //         Owes:{},//filled below 
    //         paid:0,
    //         transferred:{}
    //     }
    //     ,{
    //         name:"cyabat",
    //         isOwed:0,
    //         Owes:{},//filled below 
    //         paid:0,
    //         transferred:{}
    //     }
    //     ,{
    //         name:"challah",
    //         isOwed:0,
    //         Owes:{},//filled below
    //         paid:0,
    //         transferred:{}
    //     }
    //     ,{
    //         name:"ch435lah",
    //         isOwed:0,
    //         Owes:{},//filled below
    //         paid:0,
    //         transferred:{}
    //     }
    // ]
    
    let initial_data=[]
    roommates.forEach(roommate=>{
        initial_data.push({
            id:roommate.id,
            isOwed:0,
            Owes:{},//filled below
            paid:0,
            transferred:{}
        })
    })
    
    let name_list=[]
    initial_data.forEach(data=>{name_list.push(getRoommate(data.id).name)})
    let radioList=document.querySelectorAll('.select_name')
    //create roommates and their corresponding radio buttons
    initial_data.forEach(data=>{
        // initialize the Owes attribute of data
        for(let name of name_list){
            data.Owes[name]=0
            data.transferred[name]=0
        }
        create(data)
        array.push(data)
        // create radio buttons for this roommate
        let radioTransferFrom = document.createElement('div')
        let radioTransferTo = document.createElement('div')
        let radioPay = document.createElement('div')
        radioTransferFrom.innerHTML=`&lt;input type="radio" name="roommate" form="transfer_from">&lt;label>${getRoommate(data.id).name}&lt;/label>`
        radioTransferTo.innerHTML=`&lt;input type="radio" name="roommate" form="transfer_to">&lt;label>${getRoommate(data.id).name}&lt;/label>`
        radioPay.innerHTML=`&lt;input type="radio" name="roommate" form="pay">&lt;label>${getRoommate(data.id).name}&lt;/label>`
        radioList[0].append(radioTransferFrom)
        radioList[1].append(radioTransferTo)
        radioList[2].append(radioPay)
    })
}
/**
 * display the roommate cards list. used everytime any roommate data is modified (pay and transfer)
 */
function display_array(){
    let list=document.querySelector('ul[class="list mb-3"]')
    while(list.firstChild)
        list.removeChild(list.firstChild)
    array.forEach(data=>{create(data)})
}
/**
 * pay functionality.
 * Any payment made is equally divided among all roommates.
 * If roommate A owes some money to roommate B, when roommate A pays a bill, 
 * B's share (to be paid to A) will offset the money A owes B first. 
 */
function pay(){
    let form_pay=document.querySelector('form#pay')
    form_pay.addEventListener('submit',submit)
    function submit(e){
        e.preventDefault()
        //get inputs from submitted form
        let inputs=form_pay.elements;
        let radioLength=array.length
        let cost=parseFloat(inputs[radioLength].value)
        let to=inputs[radioLength+1].value
        let description=inputs[radioLength+2].value
        //update Owes and is Owed
        let index=0//index of selected roommate's data in array
        //The first array.length inputs are radio buttons. Loop through to find which is selected
        for(let x=0;x&lt;array.length;x++)
            if(inputs[x].checked)
                index=x;
        pay_update_array(index,cost)
        //return to home page and clear the form
        cardBox[0].classList.add('active')
        cardBox[3].classList.remove('active')
        form_pay.reset()
        //add an record to history
        history_array.push([index,cost])
        let record=document.createElement('li')
        record.className='mb-3'
        record.innerHTML=`
            &lt;input type="checkbox" form="del_history">
            &lt;span>${getRoommate(array[index].id).name} paid ${cost} for ${description}&lt;/span>
        `
        let historyList=document.querySelector('ul.historyList')
        historyList.insertBefore(record,historyList.firstChild)
    }
}
function pay_update_array(index,cost){
        array[index].paid+=cost
        let total_paid=0
        let total_debt=0
        array.forEach(data=>{total_paid+=data.paid})
        let average_paid=total_paid/array.length
        let debtors_percentage={}
        for(let x=0;x&lt;array.length;x++){
            array[x].isOwed=0
            if(array[x].paid>average_paid){
                let debtor_excess=array[x].paid-average_paid
                debtors_percentage[getRoommate(array[x].id).name]=debtor_excess//store the actual amount instead of percentage for now, will divide by total debt after we acquired it
                array[x].isOwed=debtor_excess
                array[x].isOwed=Math.round(array[x].isOwed*100)/100//round to 2 decimal places
                total_debt+=debtor_excess
            }
            for(let name in array[x].Owes)
                array[x].Owes[name]=0
        }
        for(let name in debtors_percentage){
            debtors_percentage[name]/=total_debt
        }
        for(let x=0;x&lt;array.length;x++){
            if(array[x].paid&lt;average_paid){
                for(let name in debtors_percentage){
                    array[x].Owes[name]=(average_paid-array[x].paid)*debtors_percentage[name]
                    array[x].Owes[name]=Math.round(array[x].Owes[name]*100)/100//round to 2 decimal places
                }
            }
        }
        //adding debts generated by transfer
        for(let i=0;i&lt;array.length;i++){
            for(let j=i+1;j&lt;array.length;j++){
                let amount_fst=array[i].transferred[getRoommate(array[j].id).name]
                let amount_scd=array[j].transferred[getRoommate(array[i].id).name]
                if(amount_fst>=amount_scd)
                    transfer_update_array(i,amount_fst-amount_scd,j)
                else
                    transfer_update_array(j,amount_scd-amount_fst,i)
            }
        }
        display_array()
}
/**
 * transfer functionality
 * Any transfer from roommate A to roommate B will offset the money A owes B.
 * If extra amount is paid, B owes to A.
 */
function transfer(){
    let form_transfer_from=document.querySelector('form#transfer_from')
    let form_transfer_to=document.querySelector('form#transfer_to')
    let transfer_btn=document.querySelector('#transfer_btn')
    transfer_btn.onclick=function(){
        let radios_from=form_transfer_from.elements
        let radios_to=form_transfer_to.elements
        let radioLength=array.length
        let from_index=0//index of payer
        let to_index=0//index of receiver
        for(let x=0;x&lt;radioLength;x++){
            if(radios_from[x].checked)
                from_index=x
            if(radios_to[x].checked)
                to_index=x
        }
        //update Owes and is Owed
        let input_amount=document.querySelector('input[form="transfer"]')
        let amount=parseFloat(input_amount.value)
        array[from_index].transferred[getRoommate(array[to_index].id).name]+=amount//store transfer info in transferred array
        transfer_update_array(from_index,amount,to_index)
        //return to home page and clear the form
        cardBox[0].classList.add('active')
        cardBox[2].classList.remove('active')
        form_transfer_from.reset()
        form_transfer_to.reset()
        input_amount.value=''
        //add an record to history
        history_array.push([from_index,amount,to_index])
        let record=document.createElement('li')
        record.className='mb-3'
        record.innerHTML=`
            &lt;input type="checkbox" form="del_history">
            &lt;span>${getRoommate(array[from_index].id).name} transferred ${amount} to ${getRoommate(array[to_index].id).name}&lt;/span>
        `
        let historyList=document.querySelector('ul.historyList')
        historyList.insertBefore(record,historyList.firstChild)
    }
}
function transfer_update_array(from_index,amount,to_index){
    let owed=array[from_index].Owes[getRoommate(array[to_index].id).name]
    let smaller=Math.min(amount,owed)
    array[from_index].Owes[getRoommate(array[to_index].id).name]-=smaller
    array[to_index].isOwed-=smaller
    array[from_index].isOwed+=amount-smaller
    array[to_index].Owes[getRoommate(array[from_index].id).name]+=amount-smaller
    //round to 2 decimal places, floating point error otherwise
    array[from_index].Owes[getRoommate(array[to_index].id).name]=Math.round(array[from_index].Owes[getRoommate(array[to_index].id).name]*100)/100
    array[to_index].isOwed=Math.round(array[to_index].isOwed*100)/100
    array[from_index].isOwed=Math.round(array[from_index].isOwed*100)/100
    array[to_index].Owes[getRoommate(array[from_index].id).name]=Math.round(array[to_index].Owes[getRoommate(array[from_index].id).name]*100)/100
    display_array()
}
/**
 * delete history functionality
 * check the checkboxes of the records you want to delete and click on delete button to delete them
 */
function del_history(){
    let form_del_history=document.querySelector('form#del_history')
    let list=document.querySelector('ul.historyList')
    form_del_history.addEventListener("submit",submit)
    function submit(e){
        e.preventDefault()
        let inputs=form_del_history.elements
        let to_del=[]//store elements to be deleted
        let to_del_idx=[]
        for(let x=0;x&lt;inputs.length;x++){
            if(inputs[x].checked){
                to_del_idx.push(inputs.length-2-x)
                to_del.push(inputs[x])
            }
        }
        to_del_idx.forEach(idx=>{
            if(history_array[idx].length==3){
                let [from_index,amount,to_index]=history_array[idx]
                array[from_index].transferred[getRoommate(array[to_index].id).name]-=amount
                transfer_update_array(to_index,amount,from_index)//from_index,-amount,to_index is incorrect for how transfer is implemented
            }
            else{
                let [index,cost]=history_array[idx]
                pay_update_array(index,-cost)
            }
        })
        to_del.forEach(record=>{list.removeChild(record.parentElement)})
        // //return to home page
        // cardBox[0].classList.add('active')
        // cardBox[1].classList.remove('active')
    }
}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Alert.html">Alert</a></li><li><a href="Backdrop.html">Backdrop</a></li><li><a href="BaseComponent.html">BaseComponent</a></li><li><a href="Button.html">Button</a></li><li><a href="Carousel.html">Carousel</a></li><li><a href="Collapse.html">Collapse</a></li><li><a href="Config.html">Config</a></li><li><a href="Dropdown.html">Dropdown</a></li><li><a href="FocusTrap.html">FocusTrap</a></li><li><a href="Modal.html">Modal</a></li><li><a href="Offcanvas.html">Offcanvas</a></li><li><a href="Popover.html">Popover</a></li><li><a href="ScrollBarHelper.html">ScrollBarHelper</a></li><li><a href="ScrollSpy.html">ScrollSpy</a></li><li><a href="Swipe.html">Swipe</a></li><li><a href="Tab.html">Tab</a></li><li><a href="TemplateFactory.html">TemplateFactory</a></li><li><a href="Toast.html">Toast</a></li><li><a href="Tooltip.html">Tooltip</a></li></ul><h3>Global</h3><ul><li><a href="global.html#checkDate">checkDate</a></li><li><a href="global.html#clearArchive">clearArchive</a></li><li><a href="global.html#closeChore">closeChore</a></li><li><a href="global.html#create">create</a></li><li><a href="global.html#createCard">createCard</a></li><li><a href="global.html#createChore">createChore</a></li><li><a href="global.html#createFormHandler">createFormHandler</a></li><li><a href="global.html#createNoPasswordsMessage">createNoPasswordsMessage</a></li><li><a href="global.html#createPassword">createPassword</a></li><li><a href="global.html#createPasswordForm">createPasswordForm</a></li><li><a href="global.html#createRoommate">createRoommate</a></li><li><a href="global.html#DATA_URL_PATTERN">DATA_URL_PATTERN</a></li><li><a href="global.html#del_history">del_history</a></li><li><a href="global.html#deleteNoPasswordsMessage">deleteNoPasswordsMessage</a></li><li><a href="global.html#deletePassword">deletePassword</a></li><li><a href="global.html#deletePasswordClick">deletePasswordClick</a></li><li><a href="global.html#deleteRoommate">deleteRoommate</a></li><li><a href="global.html#display_array">display_array</a></li><li><a href="global.html#editFormHandler">editFormHandler</a></li><li><a href="global.html#editPasswordForm">editPasswordForm</a></li><li><a href="global.html#elementMap">elementMap</a></li><li><a href="global.html#enableDismissTrigger">enableDismissTrigger</a></li><li><a href="global.html#getAssignees">getAssignees</a></li><li><a href="global.html#getCurrentWeek">getCurrentWeek</a></li><li><a href="global.html#getNextActiveElement">getNextActiveElement</a></li><li><a href="global.html#getRoommate">getRoommate</a></li><li><a href="global.html#getTodaysDate">getTodaysDate</a></li><li><a href="global.html#getUID">getUID</a></li><li><a href="global.html#inCharge">inCharge</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#init_list">init_list</a></li><li><a href="global.html#initFormHandler">initFormHandler</a></li><li><a href="global.html#initPage">initPage</a></li><li><a href="global.html#initRoommateAssignment">initRoommateAssignment</a></li><li><a href="global.html#makeEventUid">makeEventUid</a></li><li><a href="global.html#MAX_UID">MAX_UID</a></li><li><a href="global.html#NAME">NAME</a></li><li><a href="global.html#NAME$1">NAME$1</a></li><li><a href="global.html#NAME$2">NAME$2</a></li><li><a href="global.html#NAME$3">NAME$3</a></li><li><a href="global.html#NAME$4">NAME$4</a></li><li><a href="global.html#NAME$5">NAME$5</a></li><li><a href="global.html#NAME$6">NAME$6</a></li><li><a href="global.html#NAME$7">NAME$7</a></li><li><a href="global.html#NAME$8">NAME$8</a></li><li><a href="global.html#NAME$9">NAME$9</a></li><li><a href="global.html#NAME$a">NAME$a</a></li><li><a href="global.html#NAME$b">NAME$b</a></li><li><a href="global.html#NAME$c">NAME$c</a></li><li><a href="global.html#NAME$d">NAME$d</a></li><li><a href="global.html#NAME$e">NAME$e</a></li><li><a href="global.html#NAME$f">NAME$f</a></li><li><a href="global.html#namespaceRegex">namespaceRegex</a></li><li><a href="global.html#normalizeData">normalizeData</a></li><li><a href="global.html#openInfoPasswordClick">openInfoPasswordClick</a></li><li><a href="global.html#passIdToEditButton">passIdToEditButton</a></li><li><a href="global.html#pay">pay</a></li><li><a href="global.html#queryChore">queryChore</a></li><li><a href="global.html#queryPasswordInfo">queryPasswordInfo</a></li><li><a href="global.html#readChores">readChores</a></li><li><a href="global.html#readIdCount">readIdCount</a></li><li><a href="global.html#readPasswords">readPasswords</a></li><li><a href="global.html#readRoommate">readRoommate</a></li><li><a href="global.html#reflow">reflow</a></li><li><a href="global.html#removeFromChore">removeFromChore</a></li><li><a href="global.html#reOpenChore">reOpenChore</a></li><li><a href="global.html#SAFE_URL_PATTERN">SAFE_URL_PATTERN</a></li><li><a href="global.html#SELECTOR_FIXED_CONTENT">SELECTOR_FIXED_CONTENT</a></li><li><a href="global.html#SelectorEngine">SelectorEngine</a></li><li><a href="global.html#setupPage">setupPage</a></li><li><a href="global.html#transfer">transfer</a></li><li><a href="global.html#updateChore">updateChore</a></li><li><a href="global.html#updateDelHandler">updateDelHandler</a></li><li><a href="global.html#updatePassword">updatePassword</a></li><li><a href="global.html#updateRoommate">updateRoommate</a></li><li><a href="global.html#uriAttributes">uriAttributes</a></li><li><a href="global.html#VERSION">VERSION</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Fri Dec 02 2022 02:48:33 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
