<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: back-end/choresListAPI.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: back-end/choresListAPI.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// choresListAPI.js

/**
 * Reads 'ChoresListData' data from local storage
 * and returns a JSON with all the chores information
 * found. If nothing in local storage returns JSON with
 * initialized fields
 * @returns {Object} A JSON object of ChoresListData
 */
export function readChores() {
  if (localStorage.getItem("ChoresListData") === null) {
    const chores = {
      chores: [],
      archived: [],
      openChoresCount: 0,
      closedChoresCount: 0,
      choresCountId: 1,
    };
    localStorage.setItem("ChoresListData", JSON.stringify(chores));
    return JSON.parse(localStorage.getItem("ChoresListData"));
  } else {
    checkDate();
    return JSON.parse(localStorage.getItem("ChoresListData"));
  }
}

/**
 * queryChore focuses on providing information on a specific chore,
 * to avoid the hassle of parsing through entire lists for information
 * on one chore. Takes in two parameters: listToQuery and id.
 * listToQuery handles which list to check for the chore: archived or open.
 * id specifies the id of the chore we are looking for.
 * @param {String} listToQuery A string indicating which list to check
 * for the chore, either 'open' or 'closed'
 * @param {Int} id An integer indicating chore id
 * @return {Object} A JSON object with specific info on a chore,
 * otherwise return an empty object
 */
export function queryChore(listToQuery, id) {
  // call for all data from ChoresList feature
  const choresAPIData = JSON.parse(localStorage.getItem("ChoresListData"));

  // Check which list to search from, and do a linear search for object
  if (listToQuery === "archived") {
    for (let i = 0; i &lt; choresAPIData.archived.length(); i++) {
      if (choresAPIData.archived[i].id === id) {
        return choresAPIData.archived[i];
      }
    }
    // not found therefore return empty JSON object
    return {};
  } else {
    for (let i = 0; i &lt; choresAPIData.chores.length(); i++) {
      if (choresAPIData.chores[i].id === id) {
        return choresAPIData.chores[i];
      }
    }
    // not found therefore return empty JSON object
    return {};
  }
}

/**
 * createChore focues on creating a chore object to add to the chores(open) list.
 * It requires data from a form to fill out the fields for the chores. Updates the id
 * counter to maintain unique ids for chores and updates the amount of open chores.
 * @param {Object} formData contains the Object info for the new chore
 */
export function createChore(formData) {
  let choresAPIData = JSON.parse(localStorage.getItem("ChoresListData"));
  let newChore = {
    id: choresAPIData["choresCounterId"],
    title: formData["title"],
    description: formData["description"],
    assignee: formData["assignee"],
    assignedDate: formData["assignedDate"],
    status: "open",
    currRoommate: assignee[0],
  };
  choresAPIData.choresCounterId += 1;
  choresAPIData.openChoresCount += 1;
  choresAPIData.chores.push(newChore);
  localStorage.setItem("ChoresListData", JSON.stringify(choresAPIData));
}

/**
 * updateChore focues on updating the information for a given chore. This function allows
 * a whole remap of a chore, therefore can be used for small and big changes. Only field
 * that does not change is the id field, as it remains unique. We take three paramaeters:
 * @param {Int} id An integer indicating chore id
 * @param {String} listToQuery A string indicating which list to check
 * for the chore, either 'open' or 'closed'
 * @param {Object} formData contains the Object info for the chore
 */
export function updateChore(id, listToQuery, formData) {
  const choresAPIData = JSON.parse(localStorage.getItem("ChoresListData"));
  // setup flags so that we can ensure if we change status, it will put the chore
  // in the correct list: chores(open) or archived.
  let switchToOpen = false;
  let switchToClosed = false;

  // Do a check to see which list we should iterate through
  if (listToQuery === "archive") {
    for (let i = 0; i &lt; choresAPIData.archived.length(); i++) {
      if (choresAPIData.archived[i].id === id) {
        // set flag to indicate we need to put the chore in the other list
        if (
          formData.status === "open" &amp;&amp;
          choresAPIData.chores[i].status === "closed"
        ) {
          choresAPIData.archived[i].status = formData.open;
          switchToOpen = true;
        }
        //update our chore
        choresAPIData["archived"][i]["title"] = formData["title"];
        choresAPIData["archived"][i]["description"] = formData["description"];
        choresAPIData["archived"][i]["assignee"] = formData["assignee"];
        choresAPIData["archived"][i]["assignedDate"] = formData["assignedDate"];
        choresAPIData["archived"][i]["status"] = formData["status"];
        break;
      }
    }
  } else {
    for (let i = 0; i &lt; choresAPIData.chores.length(); i++) {
      if (choresAPIData.chores[i].id === id) {
        // set flag to indicate we need to put the chore in the other list
        if (
          formData.status === "closed" &amp;&amp;
          choresAPIData.chores[i].status === "open"
        ) {
          choresAPIData.chores[i].status = formData.open;
          switchToClosed = true;
        }
        //update our chore
        choresAPIData["chores"][i]["title"] = formData["title"];
        choresAPIData["chores"][i]["description"] = formData["description"];
        choresAPIData["chores"][i]["assignee"] = formData["assignee"];
        choresAPIData["chores"][i]["assignedDate"] = formData["assignedDate"];
        choresAPIData["chores"][i]["status"] = formData["status"];
        break;
      }
    }
  }
  // handle switching lists utilizing helper functions
  if (switchToClosed === true) {
    closeChore(id);
  }
  if (switchToOpen === true) {
    reOpenChore(id);
  }
  // update our localStorage
  localStorage.setItem("ChoresListData", JSON.stringify(choresAPIData));
}

/**
 * closeChore focues on closing out a chore or otherwise putting a given chore
 * into the archived array, so we can track completetion.
 * @param {Int} id An integer indicating chore id
 */
export function closeChore(id) {
  const choresAPIData = JSON.parse(localStorage.getItem("ChoresListData"));
  for (let i = 0; i &lt; choresAPIData.chores.length(); i++) {
    if (choresAPIData.chores[i].id === id) {
      const archivedChore = choresAPIData.chores[i];
      archivedChore.status = "closed";
      choresAPIData.chores.splice(i, 1);
      choresAPIData.archived.push(archivedChore);
      choresAPIData.closedChoresCount += 1;
      choresAPIData.openChoresCount -= 1;
      break;
    }
  }
  localStorage.setItem("ChoresListData", JSON.stringify(choresAPIData));
}

/**
 * reOpenChore focues on reOpening a chore or otherwise putting a given chore
 * into the chores(open) array, so we can track completetion.
 * @param {Int} id An integer indicating chore id
 */
export function reOpenChore(id) {
  const choresAPIData = JSON.parse(localStorage.getItem("ChoresListData"));
  for (let i = 0; i &lt; choresAPIData.archived.length(); i++) {
    if (choresAPIData.archived[i].id === id) {
      const reOpenChore = choresAPIData.archived[i];
      choresAPIData.archived.splice(i, 1);
      choresAPIData.chores.push(reOpenChore);
      choresAPIData.closedChoresCount -= 1;
      choresAPIData.openChoresCount += 1;
      break;
    }
  }
  localStorage.setItem("ChoresListData", JSON.stringify(choresAPIData));
}

/**
 * clearArchive focues on reinitializing the archived array with a new empty
 * array, so that we can clear out our backlog of issues.
 */
export function clearArchive() {
  const choresAPIData = JSON.parse(localStorage.getItem("ChoresListData"));
  choresAPIData.archived = [];
  choresAPIData.closedChoresCount = 0;
  localStorage.setItem("ChoresListData", JSON.stringify(choresAPIData));
}
// TO DO IF SPECIFIC DATA IS NEEDED
export function updateChoreCounterForRoommate(roommateId) {}
// TO DO IF SPECIFIC DATA IS NEEDED
export function updateChoreStatus(id, status) {}
// TO DO IF SPECIFIC DATA IS NEEDED
export function updateChoreOwner(choreId, oldOwnerID, newOwnerId) {}

/**
 * checkDate will change the dates assigned if needed and change the assigned
 * roommates when called from readChores
 */
export function checkDate() {
  let choresAPIData = JSON.parse(localStorage.getItem("ChoresListData"));

  const date = new Date();

  const day = date.getDate();

  const month = date.getMonth() + 1;

  const year = date.getFullYear();

  const nextWeek = new Date();

  nextWeek.setDate(nextWeek.getDate() + 7);

  const nextDay = date.getDate();

  const nextMonth = date.getMonth() + 1;

  const nextYear = date.getFullYear();

  const string = `${nextMonth}/${nextDay}/${nextYear}`;

  nextRoommate = NULL;

  //loops inside of the archived chores
  for (let i = 0; i &lt; choresAPIData["archived"].length(); i++) {
    let archivedChore = choresAPIData["archived"][i];

    for (let j = 0; j &lt; archivedChore["assignee"].length(); j++) {
      if (archivedChore["assignee"][j] == archivedChore["currRoommate"]) {
        nextRoommate =
          archivedChore["assignee"][
            (j + 1) % archivedChore["assignee"].length()
          ];
      }
    }

    const currDate = archivedChore["assignedDate"].split("/").map(Number);

    if (currDate[2] > year) {
      archivedChore["assignedDate"] = string;
      archivedChore["currRoommate"] = nextRoommate;
    } else if (currDate &lt; year) {
      //we are looking at an assigned year date
      //that is greater than our current year
      continue;
    } else {
      if (currDate[0] > month) {
        archivedChore["assignedDate"] = string;
        archivedChore["currRoommate"] = nextRoommate;
      } else if (currDate[0] &lt; month) {
        //we are looking at an assigned month date
        //that is greater than the curr month
        continue;
      } else {
        if (currDate[1] > day) {
          if (7 >= currDate[1] - day) {
            //where we change the assigned date to be updated with new date

            archivedChore["assignedDate"] = string;
            archivedChore["currRoommate"] = nextRoommate;
          }
        } else if (currDate[1] &lt; day) {
          //we are looking at an assigned day which is greater than the curr day
          continue;
        } else {
          //date is the same day so we dont care
          continue;
        }
      }
    }

    choresAPIData["archived"][i] = archivedChore;
  }

  //loops inside of the open chores
  for (let i = 0; i &lt; choresAPIData["chores"].length(); i++) {
    let openChore = choresAPIData["chores"][i];

    const currDate = openChore["assignedDate"].split("/").map(Number);

    for (let j = 0; j &lt; openChore["assignee"].length(); j++) {
      if (openChore["assignee"][j] == openChore["currRoommate"]) {
        nextRoommate =
          openChore["assignee"][(j + 1) % openChore["assignee"].length()];
      }
    }

    if (currDate[2] > year) {
      openChore["assignedDate"] = string;
      openChore["currRoommate"] = nextRoommate;
    } else if (currDate &lt; year) {
      //we are looking at an assigned year date
      //that is greater than our current year
      continue;
    } else {
      if (currDate[0] > month) {
        openChore["assignedDate"] = string;
        openChore["currRoommate"] = nextRoommate;
      } else if (currDate[0] &lt; month) {
        //we are looking at an assigned month date
        //that is greater than the curr month
        continue;
      } else {
        if (currDate[1] > day) {
          if (7 >= currDate[1] - day) {
            //where we change the assigned date to be updated with new date

            openChore["assignedDate"] = string;
            openChore["currRoommate"] = nextRoommate;
          }
        } else if (currDate[1] &lt; day) {
          //we are looking at an assigned day which is greater than the curr day
          continue;
        } else {
          //date is the same day so we dont care
          continue;
        }
      }
    }

    choresAPIData["chores"][i] = openChore;
  }

  localStorage.setItem("ChoresListData", JSON.stringify(choresAPIData));
}

/**
 * Takes in the id of a chore returns the roommate currently in charge of that chore (based on time since assigned)
 * @param {*} id id of the chore
 * @returns the id of the current roommate in charge of the chore
 */
export function inCharge(id) {
  //get ChoresListData from localStorage
  let choresAPIData = JSON.parse(localStorage.getItem("ChoresListData"));

  //check the chores list to see if the chore is there
  for (let i = 0; i &lt; choresAPIData["chores"].length(); i++) {
    if (choresAPIData["chores"][i]["id"] == id) {
      //return the current roommate in charge of the chore
      return choresAPIData["chores"][i]["currRoommate"];
    }
  }

  //check the archived list to see if the chore is there
  for (let i = 0; i &lt; choresAPIData["archived"].length(); i++) {
    if (choresAPIData["archived"][i]["id"] == id) {
      //return the current roommate in charge of the chore
      return choresAPIData["archived"][i]["currRoommate"];
    }
  }
}

/**
 * Takes in the id of the rooommate that was removed and removes that roommate from every chore they are assigned to
 * @param {*} id id of the roommate that was removed
 */
export function removeFromChore(id) {
  //get ChoresListData from localStorage
  let choresAPIData = JSON.parse(localStorage.getItem("ChoresListData"));

  //iterate through the open chores list
  for (let i = 0; i &lt; choresAPIData["chores"].length(); i++) {
    let openChore = choresAPIData["chores"][i];

    //iterate through the assignees the chore
    for (let j = 0; j &lt; openChore["assignee"].length(); j++) {
      //if the deleted roommate's id is found, remove that roommate
      if (openChore["assignee"][j] == id) {
        openChore["assignee"].splice(j, 1);
      }
    }
  }

  //iterate through the archived chores list
  for (let i = 0; i &lt; choresAPIData["archived"].length(); i++) {
    let archivedChore = choresAPIData["archived"][i];

    //iterate through the assignees the chore
    for (let j = 0; j &lt; archivedChore["assignee"].length(); j++) {
      //if the deleted roommate's id is found, remove that roommate
      if (archivedChore["assignee"][j] == id) {
        archivedChore["assignee"].splice(j, 1);
      }
    }
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#checkDate">checkDate</a></li><li><a href="global.html#clearArchive">clearArchive</a></li><li><a href="global.html#closeChore">closeChore</a></li><li><a href="global.html#createCard">createCard</a></li><li><a href="global.html#createChore">createChore</a></li><li><a href="global.html#createNoPasswordsMessage">createNoPasswordsMessage</a></li><li><a href="global.html#createPassword">createPassword</a></li><li><a href="global.html#createPasswordForm">createPasswordForm</a></li><li><a href="global.html#createRoommate">createRoommate</a></li><li><a href="global.html#deleteNoPasswordsMessage">deleteNoPasswordsMessage</a></li><li><a href="global.html#deletePassword">deletePassword</a></li><li><a href="global.html#deletePasswordClick">deletePasswordClick</a></li><li><a href="global.html#deleteRoommate">deleteRoommate</a></li><li><a href="global.html#editPasswordForm">editPasswordForm</a></li><li><a href="global.html#inCharge">inCharge</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initFormHandler">initFormHandler</a></li><li><a href="global.html#initPage">initPage</a></li><li><a href="global.html#openInfoPasswordClick">openInfoPasswordClick</a></li><li><a href="global.html#passIdToEditButton">passIdToEditButton</a></li><li><a href="global.html#queryChore">queryChore</a></li><li><a href="global.html#queryPasswordInfo">queryPasswordInfo</a></li><li><a href="global.html#readChores">readChores</a></li><li><a href="global.html#readIdCount">readIdCount</a></li><li><a href="global.html#readPasswords">readPasswords</a></li><li><a href="global.html#readRoommate">readRoommate</a></li><li><a href="global.html#removeFromChore">removeFromChore</a></li><li><a href="global.html#reOpenChore">reOpenChore</a></li><li><a href="global.html#updateChore">updateChore</a></li><li><a href="global.html#updateDelHandler">updateDelHandler</a></li><li><a href="global.html#updatePassword">updatePassword</a></li><li><a href="global.html#updateRoommate">updateRoommate</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Nov 29 2022 10:49:42 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
